<context story="21-1-locale-aware-routing-and-html-lang" created="2025-12-20T11:20:00+07:00">
  <!-- Current code state -->
  <files>
    <file path="package.json">
      <content><![CDATA[
{
  "name": "project-alpha",
  "dependencies": {
    "react": "^19.2.3",
    "react-dom": "^19.2.3",
    "@tanstack/react-start": "^1.141.7",
    "i18next": "^23.10.1",
    "react-i18next": "^15.3.0"
  },
  "devDependencies": {
    "vite": "^7.3.0",
    "typescript": "^5.9.3"
  }
}
      ]]></content>
    </file>
    <file path="src/routes/__root.tsx">
      <content><![CDATA[
// Need to see this file, placeholder for now
      ]]></content>
    </file>
  </files>
  
  <!-- Research findings from MCP tools -->
  <research_notes>
    <finding source="exa" query="react-i18next client side only translation">
      Pattern: Use initReactI18next, LanguageDetector from i18next-browser-languagedetector.
      Key insight: No need for URL routing if client-side persistence (localStorage) is sufficient.
    </finding>
    <finding source="exa" query="i18next-scanner automation">
      Tool: i18next-scanner for extracting keys from t() calls.
      Config: i18next-scanner.config.js to output sorted JSONs.
    </finding>
  </research_notes>
  
  <!-- Architecture patterns to follow -->
  <architecture_patterns>
    <pattern name="Client-Side State" source="architecture.md">
      Use localStorage for preference persistence. Avoid coupling locale to URL if requirements allow (confirmed in Epic 21 updates).
    </pattern>
    <pattern name="Lazy Loading" source="architecture.md">
      Load locale resources lazily if possible (backend plugin), though for small apps bundling generic en/vi is okay initially.
    </pattern>
  </architecture_patterns>
  
  <!-- Technical notes for developer -->
  <technical_notes>
    <note priority="high">Do NOT modify the router to add /$locale params. Keep URLs clean.</note>
    <note priority="medium">Ensure &lt;html lang&gt; updates in a useEffect in LocaleProvider.</note>
  </technical_notes>
  
  <!-- Dependencies and imports -->
  <dependencies>
    <dependency name="react-i18next" version="^15.3.0" />
    <dependency name="i18next" version="^23.10.1" />
    <dependency name="i18next-browser-languagedetector" version="latest" />
    <dependency name="i18next-scanner" (dev) version="latest" />
  </dependencies>
</context>
